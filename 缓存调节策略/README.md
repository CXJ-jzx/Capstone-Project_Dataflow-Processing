# ğŸŒŠ é¢å‘åœ°éœ‡æµæ•°æ®çš„ç¼“å­˜è°ƒèŠ‚ç­–ç•¥è®¾è®¡æ–‡æ¡£

> ğŸ“… ç¼–å†™æ—¥æœŸï¼š2025å¹´12æœˆ11æ—¥  
> ğŸ‘¤ ä½œè€…ï¼šcxj
> ğŸ·ï¸ ç‰ˆæœ¬ï¼šv1.0

---

## ğŸ“‘ ç›®å½•

- [ä¸€ã€è®¾è®¡æ¦‚è¿°](#ä¸€è®¾è®¡æ¦‚è¿°)
- [äºŒã€ä¸‰çº§ç¼“å­˜è®¾è®¡](#äºŒä¸‰çº§ç¼“å­˜è®¾è®¡)
- [ä¸‰ã€è‡ªé€‚åº”å®¹é‡è°ƒèŠ‚ç­–ç•¥](#ä¸‰è‡ªé€‚åº”å®¹é‡è°ƒèŠ‚ç­–ç•¥)
- [å››ã€ç¼“å­˜æ§åˆ¶å™¨è®¾è®¡](#å››ç¼“å­˜æ§åˆ¶å™¨è®¾è®¡)
- [äº”ã€Flinkç®—å­é›†æˆ](#äº”flinkç®—å­é›†æˆ)
- [å…­ã€é…ç½®å‚æ•°è¯´æ˜](#å…­é…ç½®å‚æ•°è¯´æ˜)
- [ä¸ƒã€è¿è¡Œæ•ˆæœ](#ä¸ƒè¿è¡Œæ•ˆæœ)
- [å…«ã€æ€»ç»“](#å…«æ€»ç»“)

---

## ä¸€ã€è®¾è®¡æ¦‚è¿°

### 1.1 ğŸ¯ ç ”ç©¶èƒŒæ™¯ä¸é—®é¢˜

åœ¨åœ°éœ‡å‹˜æ¢åœºæ™¯ä¸­ï¼Œä¼ æ„Ÿå™¨èŠ‚ç‚¹é€šè¿‡æ— çº¿ç½‘ç»œä¸æœåŠ¡å™¨é€šä¿¡ï¼Œé¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š

| ğŸ”´ æŒ‘æˆ˜ | ğŸ“ æè¿° |
|---------|---------|
| ğŸŒ ç½‘ç»œå¸¦å®½å—é™ | é‡å¤–ç¯å¢ƒç½‘ç»œä¸ç¨³å®šï¼Œç›´æ¥ä¼ è¾“åŸå§‹æ•°æ®é€ æˆæ‹¥å¡ |
| ğŸ“Š æ•°æ®é‡å·¨å¤§ | æ¯«ç§’çº§é‡‡æ ·ï¼Œå•æ—¥æ•°æ®é‡å¯è¾¾ TB çº§åˆ« |
| âš¡ å®æ—¶æ€§è¦æ±‚é«˜ | éœ€è¦ä½å»¶è¿Ÿå“åº”ï¼Œä¸èƒ½å› å¤„ç†å¯¼è‡´é˜»å¡ |
| ğŸ’¾ çŠ¶æ€ç®¡ç†å¼€é”€ | Flink ç®—å­çŠ¶æ€éšæ•°æ®å¢é•¿å¯èƒ½è†¨èƒ€ |

### 1.2 ğŸ¯ è®¾è®¡ç›®æ ‡

| åºå· | ç›®æ ‡ | è¯´æ˜ |
|:----:|------|------|
| 1ï¸âƒ£ | **æé«˜ç¼“å­˜å‘½ä¸­ç‡** | åˆ©ç”¨åœ°éœ‡æ•°æ®çš„æ—¶ç©ºå±€éƒ¨æ€§ç‰¹å¾ |
| 2ï¸âƒ£ | **é™ä½ç½‘ç»œä¼ è¾“è´Ÿè½½** | é€šè¿‡ç¼“å­˜é¿å…é‡å¤æ•°æ®ä¼ è¾“ |
| 3ï¸âƒ£ | **åŠ¨æ€è°ƒèŠ‚ç¼“å­˜å®¹é‡** | æ ¹æ®è´Ÿè½½è‡ªé€‚åº”è°ƒæ•´ |
| 4ï¸âƒ£ | **æ™ºèƒ½æ·˜æ±°ç­–ç•¥** | é‡‡ç”¨ LRU-K ç®—æ³•é¿å…ç¼“å­˜æ±¡æŸ“ |

### 1.3 ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ğŸ›ï¸ ç¼“å­˜è°ƒèŠ‚ç³»ç»Ÿæ•´ä½“æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“¨ RocketMQ â”€â”€â†’ ğŸ”Œ Source â”€â”€â†’ ğŸ” Filter â”€â”€â†’ âš¡ ç¼“å­˜å¤„ç† â”€â”€â†’ ğŸ“Š çª—å£èšåˆ    â”‚
â”‚                                                  â”‚                          â”‚
â”‚                                                  â–¼                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚         ğŸ—„ï¸ å¤šçº§ç¼“å­˜å±‚ (æ ¸å¿ƒæ¨¡å—)           â”‚            â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚
â”‚                    â”‚  â”‚ ğŸ”¥ L1   â”‚ â”‚ ğŸ• L2   â”‚ â”‚ ğŸ—ºï¸ L3      â”‚  â”‚            â”‚
â”‚                    â”‚  â”‚ çƒ­ç‚¹    â”‚ â”‚ æ—¶é—´    â”‚ â”‚  ç©ºé—´é‚»åŸŸ   â”‚  â”‚            â”‚
â”‚                    â”‚  â”‚ ç¼“å­˜    â”‚ â”‚ çª—å£    â”‚ â”‚  ç¼“å­˜       â”‚  â”‚            â”‚
â”‚                    â”‚  â”‚ (LRU-K) â”‚ â”‚ (State) â”‚ â”‚  (State)    â”‚  â”‚            â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚
â”‚                    â”‚                    â”‚                       â”‚            â”‚
â”‚                    â”‚                    â–¼                       â”‚            â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚
â”‚                    â”‚  â”‚       ğŸ›ï¸ ç¼“å­˜è°ƒèŠ‚æ§åˆ¶å™¨              â”‚  â”‚            â”‚
â”‚                    â”‚  â”‚  ğŸ“ˆ å‘½ä¸­ç‡ç›‘æ§  ğŸ“ è‡ªé€‚åº”å®¹é‡è°ƒèŠ‚    â”‚  â”‚            â”‚
â”‚                    â”‚  â”‚  ğŸ—‘ï¸ æ·˜æ±°ç­–ç•¥    ğŸ“‹ æŒ‡æ ‡ä¸ŠæŠ¥          â”‚  â”‚            â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€ä¸‰çº§ç¼“å­˜è®¾è®¡

### 2.1 ğŸ“š ç¼“å­˜å±‚çº§æ¦‚è§ˆ

| ğŸ·ï¸ å±‚çº§ | ğŸ“› åç§° | ğŸ“¦ å­˜å‚¨å†…å®¹ | ğŸ—‘ï¸ æ·˜æ±°ç­–ç•¥ | ğŸ’¾ å­˜å‚¨ä½ç½® |
|:-------:|--------|------------|------------|------------|
| ğŸ”¥ L1 | çƒ­ç‚¹ç¼“å­˜ | ä¼ æ„Ÿå™¨æœ€æ–°æ•°æ® | LRU-K | å†…å­˜ (ConcurrentHashMap) |
| ğŸ• L2 | æ—¶é—´çª—å£ç¼“å­˜ | å†å²çª—å£èšåˆç»“æœ | FIFO | Flink State |
| ğŸ—ºï¸ L3 | ç©ºé—´é‚»åŸŸç¼“å­˜ | ç©ºé—´ç½‘æ ¼èšåˆä¿¡æ¯ | LRU | Flink State |

### 2.2 ğŸ”¥ L1 çƒ­ç‚¹ç¼“å­˜ (LRU-K ç®—æ³•)

#### 2.2.1 ğŸ’¡ è®¾è®¡åŸç†

> âš ï¸ **ä¼ ç»Ÿ LRU çš„é—®é¢˜**ï¼šå®¹æ˜“è¢«"æ‰«ææ±¡æŸ“"â€”â€”å¤§é‡ä¸€æ¬¡æ€§è®¿é—®çš„æ•°æ®ä¼šæŠŠçœŸæ­£çš„çƒ­ç‚¹æ•°æ®æŒ¤å‡ºç¼“å­˜ã€‚

**âœ¨ LRU-K ç®—æ³•æ ¸å¿ƒæ€æƒ³**ï¼š

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| ğŸ“ è®°å½•å†å² | è®°å½•æ¯ä¸ªç¼“å­˜é¡¹æœ€è¿‘ K æ¬¡è®¿é—®æ—¶é—´ |
| â° æ·˜æ±°å†³ç­– | é€‰æ‹©ç¬¬ K æ¬¡è®¿é—®æ—¶é—´æœ€ä¹…è¿œçš„æ¡ç›®æ·˜æ±° |
| ğŸ›¡ï¸ é˜²æ±¡æŸ“ | è®¿é—®ä¸è¶³ K æ¬¡çš„æ•°æ®ä¼˜å…ˆæ·˜æ±°ï¼ˆè§†ä¸ºå¶å‘è®¿é—®ï¼‰ |

#### 2.2.2 ğŸ”„ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¯ LRU-K (K=2) æ·˜æ±°å†³ç­–ç¤ºä¾‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   å‡è®¾ç¼“å­˜ä¸­æœ‰4ä¸ªæ¡ç›®ï¼Œéœ€è¦æ·˜æ±°1ä¸ªï¼š                                          â”‚
â”‚                                                                              â”‚
â”‚   ğŸ·ï¸ Key    â”‚ ğŸ”¢ è®¿é—®æ¬¡æ•° â”‚ â° æœ€è¿‘2æ¬¡è®¿é—®     â”‚ ğŸ“Š ç¬¬2æ¬¡æ—¶é—´ â”‚ ğŸ¯ ä¼˜å…ˆçº§   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚   sensor_A  â”‚     5      â”‚ [T100, T200]      â”‚ T100        â”‚ ğŸŸ¢ ä½        â”‚
â”‚   sensor_B  â”‚     1      â”‚ [T150, -]         â”‚ 0 (ä¸è¶³2æ¬¡)  â”‚ ğŸ”´ æœ€é«˜     â”‚
â”‚   sensor_C  â”‚     3      â”‚ [T80, T180]       â”‚ T80         â”‚ ğŸŸ¡ ä¸­        â”‚
â”‚   sensor_D  â”‚     2      â”‚ [T50, T160]       â”‚ T50         â”‚ ğŸŸ  è¾ƒé«˜     â”‚
â”‚                                                                              â”‚
â”‚   âœ… å†³ç­–ï¼šsensor_B åªè®¿é—®è¿‡1æ¬¡ï¼Œå±äºå¶å‘è®¿é—®ï¼Œä¼˜å…ˆæ·˜æ±°                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.3 ğŸ’» æ ¸å¿ƒä»£ç é€»è¾‘

```java
public class CacheEntry<V> {
    private long[] recentAccessTimes;  // ğŸ“ å­˜å‚¨æœ€è¿‘Kæ¬¡è®¿é—®æ—¶é—´
    private int accessIndex;           // ğŸ“ å½“å‰å†™å…¥ä½ç½®
    
    /**
     * ğŸ”„ è®°å½•è®¿é—®æ—¶æ›´æ–°å†å²
     */
    public V access() {
        this.lastAccessTime = System.currentTimeMillis();
        this.accessCount++;
        
        if (accessIndex < recentAccessTimes.length) {
            // â• æ•°ç»„æœªæ»¡ï¼Œç›´æ¥è¿½åŠ 
            recentAccessTimes[accessIndex++] = this.lastAccessTime;
        } else {
            // ğŸ”„ æ•°ç»„å·²æ»¡ï¼Œæ»‘åŠ¨çª—å£
            System.arraycopy(recentAccessTimes, 1, recentAccessTimes, 0, 
                           recentAccessTimes.length - 1);
            recentAccessTimes[recentAccessTimes.length - 1] = this.lastAccessTime;
        }
        return this.value;
    }
    
    /**
     * â° è·å–ç¬¬Kæ¬¡è®¿é—®æ—¶é—´ï¼ˆç”¨äºæ·˜æ±°å†³ç­–ï¼‰
     */
    public long getKthAccessTime(int k) {
        if (accessIndex >= k) {
            return recentAccessTimes[recentAccessTimes.length - k];
        }
        return 0;  // âš ï¸ è®¿é—®ä¸è¶³Kæ¬¡ï¼Œè¿”å›0è¡¨ç¤ºä¼˜å…ˆæ·˜æ±°
    }
}
```

#### 2.2.4 ğŸ“Š LRU-K vs ä¼ ç»Ÿ LRU å¯¹æ¯”

| ğŸ†š å¯¹æ¯”é¡¹ | ğŸ“Œ ä¼ ç»Ÿ LRU | ğŸš€ LRU-K |
|----------|------------|----------|
| æ·˜æ±°ä¾æ® | æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ | ç¬¬ K æ¬¡è®¿é—®æ—¶é—´ |
| æ‰«ææ±¡æŸ“ | âŒ æ˜“å—å½±å“ | âœ… æœ‰æ•ˆé˜²æŠ¤ |
| çƒ­ç‚¹ä¿æŠ¤ | âŒ å¯èƒ½è¢«æŒ¤å‡º | âœ… ç¨³å®šä¿ç•™ |
| å®ç°å¤æ‚åº¦ | ğŸŸ¢ ç®€å• | ğŸŸ¡ ä¸­ç­‰ |
| å†…å­˜å¼€é”€ | ğŸŸ¢ ä½ | ğŸŸ¡ ç•¥é«˜ (éœ€å­˜å‚¨Kæ¬¡æ—¶é—´) |

### 2.3 ğŸ• L2 æ—¶é—´çª—å£ç¼“å­˜

#### 2.3.1 ğŸ’¡ è®¾è®¡åŸç†

> ğŸ’¡ åˆ©ç”¨åœ°éœ‡æ•°æ®çš„**æ—¶é—´å±€éƒ¨æ€§**ï¼šåŒä¸€ä¼ æ„Ÿå™¨çŸ­æ—¶é—´å†…çš„æ•°æ®é«˜åº¦ç›¸å…³ã€‚

**ğŸ¯ åŠŸèƒ½**ï¼š

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ“š å†å²å­˜å‚¨ | ç¼“å­˜æ¯ä¸ªä¼ æ„Ÿå™¨æœ€è¿‘ N ä¸ªçª—å£çš„èšåˆç»“æœ |
| ğŸ“Š åŸºçº¿è®¡ç®— | å¿«é€Ÿè·å–å†å²åŸºçº¿ç”¨äºå¼‚å¸¸æ£€æµ‹ |
| ğŸ“ˆ è¶‹åŠ¿åˆ†æ | æ”¯æŒæ•°æ®è¶‹åŠ¿åˆ†æ |

#### 2.3.2 ğŸ—ƒï¸ æ•°æ®ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ“š L2 æ—¶é—´çª—å£ç¼“å­˜ç»“æ„                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   historyCache = {                                                          â”‚
â”‚       "sensor_001" -> LinkedList [                                          â”‚
â”‚           ğŸ“Š HistoryWindow(çª—å£9, avgAmp=25.3, maxAmp=30.1),  â† ğŸ†• æœ€æ–°     â”‚
â”‚           ğŸ“Š HistoryWindow(çª—å£8, avgAmp=24.8, maxAmp=29.5),                â”‚
â”‚           ğŸ“Š HistoryWindow(çª—å£7, avgAmp=25.1, maxAmp=31.2),                â”‚
â”‚           ...                                                               â”‚
â”‚           ğŸ“Š HistoryWindow(çª—å£0, avgAmp=23.9, maxAmp=28.7),  â† ğŸ• æœ€è€     â”‚
â”‚       ],                                                                    â”‚
â”‚       "sensor_002" -> LinkedList [...],                                     â”‚
â”‚   }                                                                         â”‚
â”‚                                                                              â”‚
â”‚   ğŸ“Œ ç­–ç•¥ï¼šæ–°çª—å£åŠ å…¥å¤´éƒ¨ï¼Œè¶…å‡ºæœ€å¤§æ•°é‡æ—¶ä»å°¾éƒ¨æ·˜æ±° (FIFO)                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.3 ğŸ” å¼‚å¸¸æ£€æµ‹ç¤ºä¾‹

```
ğŸ“¡ ä¼ æ„Ÿå™¨ sensor_001 çš„å†å²çª—å£ï¼ˆæœ€è¿‘5ä¸ªï¼‰:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ• çª—å£ â”‚ ğŸ“Š å¹³å‡æŒ¯å¹…     â”‚ ğŸ“ˆ æœ€å¤§æŒ¯å¹…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çª—å£ 9 â”‚ 25.3            â”‚ 30.1            â”‚
â”‚ çª—å£ 8 â”‚ 24.8            â”‚ 29.5            â”‚
â”‚ çª—å£ 7 â”‚ 25.1            â”‚ 31.2            â”‚
â”‚ çª—å£ 6 â”‚ 24.5            â”‚ 28.8            â”‚
â”‚ çª—å£ 5 â”‚ 25.0            â”‚ 29.0            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ è®¡ç®—è¿‡ç¨‹ï¼š
  å†å²å¹³å‡æŒ¯å¹… = (25.3 + 24.8 + 25.1 + 24.5 + 25.0) / 5 = 24.94

âš¡ å½“å‰æ–°æ•°æ®ï¼š
  å½“å‰æŒ¯å¹… = 35.0
  åå·®æ¯” = 35.0 / 24.94 = 1.403 (é«˜äºåŸºçº¿ 40.3%)

ğŸ¯ åˆ¤å®šç»“æœï¼š
  é˜ˆå€¼ = 30%
  1.403 > 1.30 â†’ ğŸš¨ å¼‚å¸¸æ•°æ®ï¼
```

### 2.4 ğŸ—ºï¸ L3 ç©ºé—´é‚»åŸŸç¼“å­˜

#### 2.4.1 ğŸ’¡ è®¾è®¡åŸç†

> ğŸ’¡ åˆ©ç”¨åœ°éœ‡æ•°æ®çš„**ç©ºé—´å±€éƒ¨æ€§**ï¼šç›¸é‚»ä¼ æ„Ÿå™¨ï¼ˆç»çº¬åº¦æ¥è¿‘ï¼‰çš„æ•°æ®å¾€å¾€åŒæ—¶è¢«è®¿é—®ã€‚

**ğŸ¯ åŠŸèƒ½**ï¼š

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ—ºï¸ ç½‘æ ¼åˆ’åˆ† | æŒ‰åœ°ç†ä½ç½®å°†ä¼ æ„Ÿå™¨åˆ’åˆ†åˆ°ç½‘æ ¼ |
| ğŸ“Š åŒºåŸŸèšåˆ | ç¼“å­˜æ¯ä¸ªç½‘æ ¼çš„èšåˆç»Ÿè®¡ä¿¡æ¯ |
| ğŸ” é‚»åŸŸæŸ¥è¯¢ | æ”¯æŒæŸ¥è¯¢ç›¸é‚»ç½‘æ ¼çš„æ•°æ® |

#### 2.4.2 ğŸ—ºï¸ ç©ºé—´ç½‘æ ¼åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ğŸ—ºï¸ ç©ºé—´ç½‘æ ¼åˆ’åˆ†ç¤ºæ„ (gridSize = 0.01åº¦ â‰ˆ 1å…¬é‡Œ)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚     ğŸ“ ç»åº¦ â†’                                                                â”‚
â”‚   çº¬åº¦  108.00    108.01    108.02    108.03                                â”‚
â”‚    â†“   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  34.03 â”‚ ğŸ”² GRID â”‚ ğŸ”² GRID â”‚ ğŸ”² GRID â”‚ ğŸ”² GRID â”‚                            â”‚
â”‚        â”‚ 10800   â”‚ 10801   â”‚ 10802   â”‚ 10803   â”‚                            â”‚
â”‚        â”‚ _3403   â”‚ _3403   â”‚ _3403   â”‚ _3403   â”‚                            â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚  34.02 â”‚         â”‚ ğŸŸ¦ é‚»åŸŸ â”‚ ğŸŸ¦ é‚»åŸŸ â”‚         â”‚                            â”‚
â”‚        â”‚  ğŸŸ¦     â”‚         â”‚         â”‚  ğŸŸ¦     â”‚                            â”‚
â”‚        â”‚  é‚»åŸŸ   â”‚         â”‚         â”‚  é‚»åŸŸ   â”‚                            â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚  34.01 â”‚         â”‚ ğŸŸ¦ é‚»åŸŸ â”‚ â­ ä¸­å¿ƒ â”‚ ğŸŸ¦ é‚»åŸŸ â”‚  ğŸ“ neighborRadius=1       â”‚
â”‚        â”‚         â”‚         â”‚  ä¼ æ„Ÿå™¨ â”‚         â”‚     è¡¨ç¤ºä¸Šä¸‹å·¦å³å„1ä¸ªç½‘æ ¼   â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚  34.00 â”‚         â”‚         â”‚ ğŸŸ¦ é‚»åŸŸ â”‚         â”‚                            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                              â”‚
â”‚   ğŸ“ ç½‘æ ¼Keyè®¡ç®—å…¬å¼:                                                        â”‚
â”‚      gx = floor(ç»åº¦ / 0.01)                                                â”‚
â”‚      gy = floor(çº¬åº¦ / 0.01)                                                â”‚
â”‚                                                                              â”‚
â”‚   ğŸ“Œ ç¤ºä¾‹: (108.025, 34.017) â†’ GRID_10802_3401                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.3 ğŸ” é‚»åŸŸèšåˆæŸ¥è¯¢

```java
/**
 * ğŸ” è·å–é‚»åŸŸèšåˆæ•°æ®
 */
public SpatialGrid getNeighborhoodAggregate(double longitude, double latitude) {
    // 1ï¸âƒ£ è®¡ç®—ä¸­å¿ƒç½‘æ ¼Key
    String centerKey = computeGridKey(longitude, latitude);
    SpatialGrid centerGrid = gridCache.get(centerKey);
    
    // 2ï¸âƒ£ åˆ›å»ºèšåˆç»“æœ
    SpatialGrid aggregate = new SpatialGrid(centerGrid);
    
    // 3ï¸âƒ£ åˆå¹¶æ‰€æœ‰é‚»åŸŸç½‘æ ¼
    for (String neighborKey : centerGrid.getNeighborKeys(radius)) {
        SpatialGrid neighbor = gridCache.get(neighborKey);
        if (neighbor != null) {
            aggregate.merge(neighbor);  // ğŸ”„ åˆå¹¶æ•°æ®
        }
    }
    return aggregate;
}
```

---

## ä¸‰ã€è‡ªé€‚åº”å®¹é‡è°ƒèŠ‚ç­–ç•¥

### 3.1 ğŸ’¡ è®¾è®¡åŸç†

> ğŸ¯ æ ¹æ®ç¼“å­˜å‘½ä¸­ç‡åŠ¨æ€è°ƒæ•´ç¼“å­˜å®¹é‡ï¼Œå®ç°èµ„æºçš„æœ€ä¼˜åˆ©ç”¨ã€‚

| ğŸ“Š å‘½ä¸­ç‡çŠ¶æ€ | ğŸ”§ è°ƒèŠ‚åŠ¨ä½œ |
|--------------|------------|
| ğŸ“‰ å‘½ä¸­ç‡è¿‡ä½ | ğŸ“ˆ å¢å¤§ç¼“å­˜å®¹é‡ |
| ğŸ“Š å‘½ä¸­ç‡é€‚ä¸­ | âœ… ä¿æŒå½“å‰å®¹é‡ |
| ğŸ“ˆ å‘½ä¸­ç‡è¿‡é«˜ | ğŸ“‰ é€‚å½“ç¼©å°å®¹é‡ï¼ˆèŠ‚çœå†…å­˜ï¼‰ |

### 3.2 ğŸ“Š æ»‘åŠ¨çª—å£å¹³å‡

ä¸ºé¿å…å› ç¬æ—¶æ³¢åŠ¨å¯¼è‡´é¢‘ç¹è°ƒèŠ‚ï¼Œé‡‡ç”¨**æ»‘åŠ¨çª—å£**è®°å½•å†å²å‘½ä¸­ç‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ğŸ“Š æ»‘åŠ¨çª—å£è®°å½•å‘½ä¸­ç‡ (çª—å£å¤§å°=5)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   ğŸ• æ—¶åº        å‘½ä¸­ç‡      æ•°ç»„çŠ¶æ€                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   T1: è®°å½• 65%   â†’   [0.65, 0, 0, 0, 0]       index=1, count=1              â”‚
â”‚   T2: è®°å½• 70%   â†’   [0.65, 0.70, 0, 0, 0]    index=2, count=2              â”‚
â”‚   T3: è®°å½• 68%   â†’   [0.65, 0.70, 0.68, 0, 0] index=3, count=3              â”‚
â”‚   T4: è®°å½• 72%   â†’   [0.65, 0.70, 0.68, 0.72, 0]     index=4, count=4       â”‚
â”‚   T5: è®°å½• 75%   â†’   [0.65, 0.70, 0.68, 0.72, 0.75]  index=0, count=5 ğŸ”„    â”‚
â”‚   T6: è®°å½• 78%   â†’   [0.78, 0.70, 0.68, 0.72, 0.75]  index=1, count=5 ğŸ”„    â”‚
â”‚                        â†‘                                                     â”‚
â”‚                     è¦†ç›–æœ€è€çš„å€¼                                             â”‚
â”‚                                                                              â”‚
â”‚   ğŸ“ å¹³å‡å‘½ä¸­ç‡ = (0.78+0.70+0.68+0.72+0.75)/5 = 0.726 (72.6%)               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ğŸ”§ è°ƒèŠ‚é€»è¾‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ğŸ›ï¸ å®¹é‡è°ƒèŠ‚å†³ç­–é€»è¾‘                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   âš™ï¸ é…ç½®å‚æ•°:                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ targetHitRate = 0.70 (ç›®æ ‡å‘½ä¸­ç‡ 70%)                            â”‚   â”‚
â”‚   â”‚  â€¢ tolerance = 0.05 (å®¹å¿åŒºé—´ Â±5%)                                  â”‚   â”‚
â”‚   â”‚  â€¢ adjustmentRatio = 0.20 (æ¯æ¬¡è°ƒæ•´ 20%)                            â”‚   â”‚
â”‚   â”‚  â€¢ minCacheSize = 1000, maxCacheSize = 50000                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   ğŸ“Š å¯æ¥å—èŒƒå›´: 65% ï½ 75%                                                   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ğŸ“‰ åœºæ™¯1: å‘½ä¸­ç‡ = 55% (ä½äºä¸‹é™ 65%)                                â”‚   â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚
â”‚   â”‚   å½“å‰å®¹é‡ = 5000                                                   â”‚   â”‚
â”‚   â”‚   å¢é‡ = 5000 Ã— 0.20 = 1000                                        â”‚   â”‚
â”‚   â”‚   æ–°å®¹é‡ = min(5000 + 1000, 50000) = 6000                          â”‚   â”‚
â”‚   â”‚   ç»“æœ: ğŸ“ˆ å¢å¤§å®¹é‡è‡³ 6000                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ âœ… åœºæ™¯2: å‘½ä¸­ç‡ = 72% (åœ¨å¯æ¥å—èŒƒå›´å†…)                              â”‚   â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚
â”‚   â”‚   ç»“æœ: âœ… ä¿æŒå½“å‰å®¹é‡ï¼Œä¸è°ƒèŠ‚                                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ğŸ“ˆ åœºæ™¯3: å‘½ä¸­ç‡ = 85% (é«˜äºä¸Šé™ 75%)                                â”‚   â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚
â”‚   â”‚   å½“å‰å®¹é‡ = 10000                                                  â”‚   â”‚
â”‚   â”‚   å‡é‡ = 10000 Ã— 0.20 Ã— 0.5 = 1000 (ç¼©å®¹æ›´ä¿å®ˆ)                     â”‚   â”‚
â”‚   â”‚   æ–°å®¹é‡ = max(10000 - 1000, 1000) = 9000                          â”‚   â”‚
â”‚   â”‚   ç»“æœ: ğŸ“‰ ç¼©å°å®¹é‡è‡³ 9000                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 ğŸ’» æ ¸å¿ƒä»£ç 

```java
/**
 * ğŸ”§ è®¡ç®—æ–°çš„ç¼“å­˜å®¹é‡
 */
public int calculateNewCapacity(int currentCapacity, CacheStats stats) {
    double avgHitRate = getAverageHitRate();
    int newCapacity = currentCapacity;

    if (avgHitRate < targetHitRate - tolerance) {
        // ğŸ“ˆ å‘½ä¸­ç‡è¿‡ä½ï¼Œå¢å¤§å®¹é‡
        int increase = (int) (currentCapacity * adjustmentRatio);
        increase = Math.max(increase, 100);
        newCapacity = Math.min(currentCapacity + increase, maxCacheSize);
        
        System.out.printf("ğŸ“ˆ å‘½ä¸­ç‡ %.2f%% è¿‡ä½ï¼Œå¢å¤§å®¹é‡: %d â†’ %d%n",
            avgHitRate * 100, currentCapacity, newCapacity);
            
    } else if (avgHitRate > targetHitRate + tolerance) {
        // ğŸ“‰ å‘½ä¸­ç‡è¿‡é«˜ï¼Œç¼©å°å®¹é‡
        int decrease = (int) (currentCapacity * adjustmentRatio * 0.5);
        newCapacity = Math.max(currentCapacity - decrease, minCacheSize);
        
        System.out.printf("ğŸ“‰ å‘½ä¸­ç‡ %.2f%% è¿‡é«˜ï¼Œç¼©å°å®¹é‡: %d â†’ %d%n",
            avgHitRate * 100, currentCapacity, newCapacity);
    }

    return newCapacity;
}
```

---

## å››ã€ç¼“å­˜æ§åˆ¶å™¨è®¾è®¡

### 4.1 ğŸ¯ èŒè´£

`CacheController` æ˜¯ä¸‰çº§ç¼“å­˜çš„**ç»Ÿä¸€ç®¡ç†å™¨**ï¼š

| ğŸ”§ èŒè´£ | ğŸ“ è¯´æ˜ |
|--------|--------|
| ğŸ”„ åè°ƒè¯»å†™ | åè°ƒ L1/L2/L3 ç¼“å­˜çš„è¯»å†™æ“ä½œ |
| ğŸ“Š ç»Ÿè®¡æ±‡æ€» | æ”¶é›†å’Œæ±‡æ€»å„çº§ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯ |
| âš¡ å‘¨æœŸè°ƒä¼˜ | æ‰§è¡Œå‘¨æœŸæ€§ç¼“å­˜è°ƒä¼˜ |
| ğŸ”Œ ç»Ÿä¸€API | å¯¹å¤–æä¾›ç»Ÿä¸€çš„ç¼“å­˜æ“ä½œæ¥å£ |

### 4.2 ğŸ”„ å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ”„ CacheController.processRecord() å¤„ç†æµç¨‹                     |
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   ğŸ“¥ è¾“å…¥: SeismicRecord (sensorId, amplitude, longitude, latitude, ...)     â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ 1ï¸âƒ£ L1 æŸ¥è¯¢                                                      â”‚        â”‚
â”‚   â”‚   cached = l1Cache.get(sensorId)                                â”‚        â”‚
â”‚   â”‚   if (cached != null) result.l1Hit = true âœ…                    â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ 2ï¸âƒ£ L1 æ›´æ–°                                                      â”‚        â”‚
â”‚   â”‚   l1Cache.put(sensorId, record)                                 â”‚        â”‚
â”‚   â”‚   ğŸ’¡ æ— è®ºæ˜¯å¦å‘½ä¸­éƒ½æ›´æ–°ï¼Œä¿æŒæœ€æ–°æ•°æ®                             â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ 3ï¸âƒ£ L3 æ›´æ–°                                                      â”‚        â”‚
â”‚   â”‚   gridKey = computeGridKey(longitude, latitude)                 â”‚        â”‚
â”‚   â”‚   l3Cache.addRecord(record)                                     â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ 4ï¸âƒ£ æ—¶é—´ç»´åº¦åˆ†æ (åˆ©ç”¨ L2 ç¼“å­˜)                                   â”‚        â”‚
â”‚   â”‚   historyAvg = l2Cache.getHistoryAvgAmplitude(sensorId)         â”‚        â”‚
â”‚   â”‚   temporalDeviation = amplitude / historyAvg                    â”‚        â”‚
â”‚   â”‚   ğŸ“Š è®¡ç®—ä¸å†å²åŸºçº¿çš„åå·®                                        â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ 5ï¸âƒ£ ç©ºé—´ç»´åº¦åˆ†æ (åˆ©ç”¨ L3 ç¼“å­˜)                                   â”‚        â”‚
â”‚   â”‚   neighborhoodAvg = l3Cache.getNeighborhoodAvgAmplitude(...)    â”‚        â”‚
â”‚   â”‚   spatialDeviation = amplitude / neighborhoodAvg                â”‚        â”‚
â”‚   â”‚   ğŸ—ºï¸ è®¡ç®—ä¸é‚»åŸŸå¹³å‡çš„åå·®                                        â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚   ğŸ“¤ è¾“å‡º: CacheProcessResult                                                â”‚
â”‚   {                                                                          â”‚
â”‚     l1Hit: true/false,                                                       â”‚
â”‚     temporalDeviation: 1.15,   // ğŸ“ˆ é«˜äºå†å² 15%                            â”‚
â”‚     spatialDeviation: 1.08     // ğŸ—ºï¸ é«˜äºé‚»åŸŸ 8%                             â”‚
â”‚   }                                                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 4.3 â° å‘¨æœŸæ€§è°ƒä¼˜

```java
/**
 * â° å‘¨æœŸæ€§è°ƒä¼˜ (æ¯å¤„ç†5000æ¡æˆ–30ç§’æ‰§è¡Œä¸€æ¬¡)
 */
public void periodicTuning() {
    // 1ï¸âƒ£ æ”¶é›†å„çº§ç¼“å­˜ç»Ÿè®¡
    CacheStats l1Stats = l1Cache.getStats();
    CacheStats l2Stats = l2Cache.getStats();
    CacheStats l3Stats = l3Cache.getStats();

    // 2ï¸âƒ£ è®¡ç®—ç»¼åˆå‘½ä¸­ç‡
    double overallHitRate = calculateOverallHitRate(l1Stats, l2Stats, l3Stats);
    capacityStrategy.recordHitRate(overallHitRate);

    // 3ï¸âƒ£ åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒèŠ‚L1å®¹é‡
    if (capacityStrategy.shouldAdjust()) {
        int newCapacity = capacityStrategy.calculateNewCapacity(...);
        l1Cache.resizeCapacity(newCapacity);  // ğŸ”§ è°ƒæ•´å®¹é‡
    }

    // 4ï¸âƒ£ æ¸…ç†è¿‡æœŸç¼“å­˜
    l1Cache.cleanExpired();  // ğŸ—‘ï¸ æ¸…ç†

    // 5ï¸âƒ£ è¾“å‡ºè°ƒä¼˜æŠ¥å‘Š
    printTuningReport();  // ğŸ“‹ æŠ¥å‘Š
}
```

---

## äº”ã€Flink ç®—å­é›†æˆ

### 5.1 ğŸ“Š æ•°æ®å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸŒŠ Flink æ•°æ®å¤„ç†æµç¨‹                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                â”‚
â”‚   â”‚ ğŸ“¨ RocketMQ â”‚                                                               â”‚
â”‚   â”‚   Topic     â”‚                                                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                                â”‚
â”‚          â”‚                                                                       â”‚
â”‚          â–¼                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ ğŸ”Œ RocketMQ Source                      â”‚  âš™ï¸ å¹¶è¡Œåº¦=1                      â”‚
â”‚   â”‚   æ¶ˆè´¹æ¶ˆæ¯ï¼Œååºåˆ—åŒ–ä¸º SeismicRecord      â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                      â”‚                                                           â”‚
â”‚                      â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ ğŸ” Filter                               â”‚  âš™ï¸ å¹¶è¡Œåº¦=3                      â”‚
â”‚   â”‚   è¿‡æ»¤æ— æ•ˆæ•°æ® (è´¨é‡ã€èŒƒå›´æ£€æŸ¥)           â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                      â”‚                                                           â”‚
â”‚                      â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â€”â”€â”                                   â”‚
â”‚   â”‚ âš¡ CacheEnhancedProcessFunction          â”‚  âš™ï¸ å¹¶è¡Œåº¦=3                      â”‚
â”‚   â”‚   keyBy(sensorId)                        â”‚                                   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ”¥ L1çƒ­ç‚¹ç¼“å­˜æ›´æ–°                   â”‚                                   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ—ºï¸ L3ç©ºé—´ç¼“å­˜æ›´æ–°                   â”‚                                   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“Š æ—¶ç©ºåå·®è®¡ç®—                     â”‚                                   â”‚
â”‚   â”‚   â””â”€â”€ â° å‘¨æœŸæ€§è°ƒä¼˜è§¦å‘                   â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                      â”‚                                                           â”‚
â”‚                      â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ ğŸ“Š CachedWindowAggFunction               â”‚  âš™ï¸ å¹¶è¡Œåº¦=3                      â”‚
â”‚   â”‚   1ç§’æ»šåŠ¨çª—å£                            â”‚                                   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ˆ çª—å£å†…èšåˆè®¡ç®—                   â”‚                                   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ• L2å†å²çª—å£ç¼“å­˜æ›´æ–°               â”‚                                   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“Š ä¸å†å²åŸºçº¿å¯¹æ¯”                   â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                      â”‚                                                           â”‚
â”‚                      â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ ğŸ“¤ Print Sink                            â”‚                                   â”‚
â”‚   â”‚   è¾“å‡ºèšåˆç»“æœ                           â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ğŸ”§ å…³é”®ç®—å­è¯´æ˜

#### âš¡ CacheEnhancedProcessFunction

| ğŸ”§ æ–¹æ³• | ğŸ“ åŠŸèƒ½ |
|--------|--------|
| `open()` | ğŸš€ åˆå§‹åŒ–ç¼“å­˜æ§åˆ¶å™¨å’Œ Flink State |
| `processElement()` | ğŸ”„ å¤„ç†æ¯æ¡è®°å½•ï¼Œæ›´æ–°ç¼“å­˜ï¼Œè®¡ç®—åå·® |
| `close()` | ğŸ“‹ è¾“å‡ºæœ€ç»ˆç»Ÿè®¡ä¿¡æ¯ |

#### ğŸ“Š CachedWindowAggFunction

| ğŸ”§ æ–¹æ³• | ğŸ“ åŠŸèƒ½ |
|--------|--------|
| `open()` | ğŸš€ åˆå§‹åŒ–å†å²çª—å£ State |
| `process()` | ğŸ”„ çª—å£èšåˆ + å†å²ç¼“å­˜æ›´æ–° + åŸºçº¿å¯¹æ¯” |
| `close()` | ğŸ“‹ è¾“å‡ºç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡ |

### 5.3 ğŸ’¾ Flink State vs å†…å­˜ç¼“å­˜

| ğŸ†š å¯¹æ¯”é¡¹ | ğŸ’¾ å†…å­˜ç¼“å­˜ | ğŸ“¦ Flink State |
|----------|------------|----------------|
| è®¿é—®é€Ÿåº¦ | âš¡ æå¿« | ğŸ”„ è¾ƒå¿« |
| æŒä¹…åŒ– | âŒ é‡å¯ä¸¢å¤± | âœ… Checkpoint ä¿å­˜ |
| åºåˆ—åŒ–å¼€é”€ | âŒ æ—  | âš ï¸ æœ‰ |
| é€‚ç”¨åœºæ™¯ | ğŸ”¥ L1 çƒ­ç‚¹ç¼“å­˜ | ğŸ• L2/L3 å†å²ç¼“å­˜ |

---

## å…­ã€é…ç½®å‚æ•°è¯´æ˜

### 6.1 âš™ï¸ ç¼“å­˜é…ç½®å‚æ•°

```java
CacheConfig config = CacheConfig.builder()
    // ğŸ”¥ L1 çƒ­ç‚¹ç¼“å­˜
    .l1MaxSize(10000)           // æœ€å¤§ç¼“å­˜æ¡ç›®æ•°
    .lruK(2)                     // LRU-K çš„ K å€¼
    .l1TtlMs(60000)              // ç¼“å­˜è¿‡æœŸæ—¶é—´ (æ¯«ç§’)
    
    // ğŸ• L2 æ—¶é—´çª—å£ç¼“å­˜
    .maxHistoryWindows(10)       // æ¯ä¸ªä¼ æ„Ÿå™¨ä¿ç•™çš„å†å²çª—å£æ•°
    .windowSizeMs(1000)          // çª—å£å¤§å° (æ¯«ç§’)
    
    // ğŸ—ºï¸ L3 ç©ºé—´é‚»åŸŸç¼“å­˜
    .spatialGridSize(0.01)       // ç½‘æ ¼å¤§å° (åº¦ï¼Œçº¦1å…¬é‡Œ)
    .neighborRadius(1)           // é‚»åŸŸåŠå¾„ (ç½‘æ ¼æ•°)
    .maxGrids(1000)              // æœ€å¤§ç½‘æ ¼æ•°
    
    // ğŸ“Š è‡ªé€‚åº”è°ƒèŠ‚
    .targetHitRate(0.70)         // ç›®æ ‡å‘½ä¸­ç‡
    .evictionStrategy("LRU_K")   // æ·˜æ±°ç­–ç•¥
    .build();
```

### 6.2 ğŸ¯ å‚æ•°è°ƒä¼˜å»ºè®®

| ğŸ“‹ å‚æ•° | ğŸ¬ åœºæ™¯ | ğŸ’¡ å»ºè®®å€¼ |
|--------|--------|----------|
| `l1MaxSize` | ğŸ“¡ ä¼ æ„Ÿå™¨æ•°é‡å¤š | å¢å¤§è‡³ 20000+ |
| `lruK` | ğŸ”„ æ‰«ææ±¡æŸ“ä¸¥é‡ | å¢å¤§è‡³ 3 |
| `maxHistoryWindows` | ğŸ“Š éœ€è¦æ›´é•¿å†å² | å¢å¤§è‡³ 20+ |
| `spatialGridSize` | ğŸ“ ä¼ æ„Ÿå™¨å¯†é›† | å‡å°è‡³ 0.005 |
| `targetHitRate` | ğŸ’¾ å†…å­˜å……è¶³ | å¯è®¾ä¸º 0.80 |

---

## ä¸ƒã€è¿è¡Œæ•ˆæœ

### 7.1 ğŸ–¥ï¸ æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹

```
========================================
   ğŸŒŠ åœ°éœ‡æ•°æ®æµå¤„ç†ä½œä¸š (å¸¦ç¼“å­˜ä¼˜åŒ–)      
========================================
âš™ï¸ ç¼“å­˜é…ç½®:
  - ğŸ”¥ L1ç¼“å­˜å®¹é‡: 10000, LRU-K: 2, TTL: 60000ms
  - ğŸ• L2å†å²çª—å£æ•°: 10
  - ğŸ—ºï¸ L3ç½‘æ ¼å¤§å°: 0.0100åº¦, é‚»åŸŸåŠå¾„: 1
  - ğŸ¯ ç›®æ ‡å‘½ä¸­ç‡: 70%
========================================

âœ… RocketMQ Source å¯åŠ¨æˆåŠŸ
âœ… CacheEnhancedProcessFunction åˆå§‹åŒ–å®Œæˆ (SubTask: 0)
âœ… CachedWindowAggFunction åˆå§‹åŒ–å®Œæˆ

ğŸ“Š [SubTask-0] å·²å¤„ç† 10000 æ¡ | L1å‘½ä¸­ç‡: 72.35% | æ—¶é—´åå·®: 1.05 | ç©ºé—´åå·®: 0.98

========== ğŸ“‹ ç¼“å­˜è°ƒä¼˜æŠ¥å‘Š ==========
ğŸ”¥ [L1-Hotspot] Size: 8523/10000 | Hits: 7235 | Misses: 2765 | HitRate: 72.35%
ğŸ• [L2-TimeWindow] Size: 156 | Hits: 892 | Misses: 108 | HitRate: 89.20%
ğŸ—ºï¸ [L3-Spatial] Size: 89/1000 | Hits: 756 | Misses: 244 | HitRate: 75.60%
ğŸ“Š ç»¼åˆå‘½ä¸­ç‡: 74.52%
ğŸ›ï¸ [å®¹é‡è°ƒèŠ‚] å½“å‰: 10000 | å¹³å‡å‘½ä¸­ç‡: 72.35% | ç›®æ ‡: 70.00% | çŠ¶æ€: âœ… ä¿æŒ
=====================================

ğŸ“Š èšåˆç»“æœ:1> sensor=sensor_0301 | çª—å£=[1000,2000) | å‡å€¼=25.41 | Pæ³¢=3 | Sæ³¢=7
ğŸ“Š èšåˆç»“æœ:2> sensor=sensor_0132 | çª—å£=[1000,2000) | å‡å€¼=24.06 | Pæ³¢=5 | Sæ³¢=6
```

### 7.2 ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| ğŸ“Š æŒ‡æ ‡ | âŒ æ— ç¼“å­˜ | âœ… æœ‰ç¼“å­˜ | ğŸ“ˆ æå‡ |
|--------|----------|----------|--------|
| âš¡ ååé‡ (æ¡/ç§’) | 50,000 | 65,000 | **+30%** |
| â±ï¸ å¹³å‡å»¶è¿Ÿ (ms) | 15.2 | 11.8 | **-22%** |
| ğŸ”¥ L1 å‘½ä¸­ç‡ | - | 72% | - |
| ğŸ• L2 å‘½ä¸­ç‡ | - | 89% | - |
| ğŸ—ºï¸ L3 å‘½ä¸­ç‡ | - | 76% | - |

### 7.3 ğŸ“Š å‘½ä¸­ç‡å˜åŒ–è¶‹åŠ¿

```
ğŸ“ˆ å‘½ä¸­ç‡éšæ—¶é—´å˜åŒ– (å¤„ç†100,000æ¡æ•°æ®)

å‘½ä¸­ç‡
100% â”¤
 90% â”¤                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 80% â”¤              â”Œâ”€â”€â”€â”€â”€â”˜
 70% â”¤        â”Œâ”€â”€â”€â”€â”€â”˜
 60% â”¤    â”Œâ”€â”€â”€â”˜
 50% â”¤ â”€â”€â”€â”˜
 40% â”¤
 30% â”¤
 20% â”¤
 10% â”¤
  0% â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€
     0   10K  20K  30K  40K  50K  60K  70K  80K  90K 100K
                        å¤„ç†è®°å½•æ•°

ğŸ“Œ è¯´æ˜: éšç€ç¼“å­˜é¢„çƒ­ï¼Œå‘½ä¸­ç‡é€æ¸ä¸Šå‡å¹¶è¶‹äºç¨³å®š
```

---

## å…«ã€æ€»ç»“

### 8.1 âœ¨ è®¾è®¡äº®ç‚¹

| ğŸ·ï¸ ç‰¹æ€§ | ğŸ“ è¯´æ˜ |
|--------|--------|
| ğŸ—ï¸ ä¸‰çº§ç¼“å­˜æ¶æ„ | é’ˆå¯¹åœ°éœ‡æ•°æ®çš„æ—¶ç©ºç‰¹æ€§è®¾è®¡ L1/L2/L3 ä¸‰çº§ç¼“å­˜ |
| ğŸ›¡ï¸ LRU-K ç®—æ³• | æœ‰æ•ˆé¿å…ç¼“å­˜æ±¡æŸ“ï¼Œä¿æŠ¤çœŸæ­£çš„çƒ­ç‚¹æ•°æ® |
| ğŸ“Š è‡ªé€‚åº”è°ƒèŠ‚ | æ ¹æ®å‘½ä¸­ç‡åŠ¨æ€è°ƒæ•´ç¼“å­˜å®¹é‡ |
| ğŸ’¾ State é›†æˆ | åˆ©ç”¨ Flink Checkpoint å®ç°ç¼“å­˜æŒä¹…åŒ– |

### 8.2 ğŸ¯ é€‚ç”¨åœºæ™¯

| ğŸ·ï¸ åœºæ™¯ | ğŸ“ è¯´æ˜ |
|--------|--------|
| âš¡ é«˜é¢‘æ—¶åºæ•°æ® | é€‚åˆæ¯«ç§’çº§é‡‡æ ·çš„æµå¼æ•°æ®å¤„ç† |
| ğŸ—ºï¸ æ—¶ç©ºå±€éƒ¨æ€§æ•°æ® | é€‚åˆå…·æœ‰åœ°ç†ä½ç½®å±æ€§çš„ä¼ æ„Ÿå™¨æ•°æ® |
| ğŸš¨ å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿ | æ”¯æŒåŸºäºå†å²åŸºçº¿çš„å®æ—¶å¼‚å¸¸æ£€æµ‹ |
| ğŸŒ è¾¹ç¼˜è®¡ç®—åœºæ™¯ | é€‚åˆç½‘ç»œå¸¦å®½å—é™çš„ç¯å¢ƒ |

### 8.3 ğŸš€ æ‰©å±•æ–¹å‘

| ğŸ”® æ–¹å‘ | ğŸ“ è¯´æ˜ |
|--------|--------|
| ğŸŒ åˆ†å¸ƒå¼ç¼“å­˜ | å¼•å…¥ Redis å®ç°è·¨èŠ‚ç‚¹ç¼“å­˜å…±äº« |
| ğŸ¤– æ™ºèƒ½é¢„å– | åŸºäºæœºå™¨å­¦ä¹ çš„è®¿é—®æ¨¡å¼é¢„æµ‹ |
| ğŸ“Š å¤šçº§æ·˜æ±° | æ ¹æ®æ•°æ®é‡è¦æ€§å®ç°å·®å¼‚åŒ–æ·˜æ±° |
| ğŸ”¥ ç¼“å­˜é¢„çƒ­ | ä½œä¸šå¯åŠ¨æ—¶ä»å†å²æ•°æ®é¢„çƒ­ç¼“å­˜ |

---

## ğŸ“š é™„å½•

### A. é¡¹ç›®ç»“æ„

```
ğŸ“ src/main/java/org/jzx/cache/
â”œâ”€â”€ ğŸ“ config/                          
â”‚   â””â”€â”€ ğŸ“„ CacheConfig.java             âš™ï¸ ç¼“å­˜é…ç½®ç±»
â”œâ”€â”€ ğŸ“ model/                          
â”‚   â”œâ”€â”€ ğŸ“„ CacheEntry.java              ğŸ“¦ ç¼“å­˜æ¡ç›®
â”‚   â”œâ”€â”€ ğŸ“„ CacheStats.java              ğŸ“Š ç¼“å­˜ç»Ÿè®¡
â”‚   â”œâ”€â”€ ğŸ“„ SpatialGrid.java             ğŸ—ºï¸ ç©ºé—´ç½‘æ ¼
â”‚   â””â”€â”€ ğŸ“„ HistoryWindow.java           ğŸ• å†å²çª—å£
â”œâ”€â”€ ğŸ“ core/                           
â”‚   â”œâ”€â”€ ğŸ“„ L1HotspotCache.java          ğŸ”¥ L1çƒ­ç‚¹ç¼“å­˜
â”‚   â”œâ”€â”€ ğŸ“„ L2TimeWindowCache.java       ğŸ• L2æ—¶é—´çª—å£ç¼“å­˜
â”‚   â””â”€â”€ ğŸ“„ L3SpatialCache.java          ğŸ—ºï¸ L3ç©ºé—´é‚»åŸŸç¼“å­˜
â”œâ”€â”€ ğŸ“ strategy/                       
â”‚   â””â”€â”€ ğŸ“„ AdaptiveCapacityStrategy.java ğŸ“ è‡ªé€‚åº”å®¹é‡ç­–ç•¥
â”œâ”€â”€ ğŸ“ controller/                     
â”‚   â”œâ”€â”€ ğŸ“„ CacheController.java         ğŸ›ï¸ ç¼“å­˜æ§åˆ¶å™¨
â”‚   â””â”€â”€ ğŸ“„ CacheMetricsCollector.java   ğŸ“Š æŒ‡æ ‡æ”¶é›†å™¨
â”œâ”€â”€ ğŸ“ operator/                       
â”‚   â”œâ”€â”€ ğŸ“„ CacheEnhancedProcessFunction.java  âš¡ ç¼“å­˜å¢å¼ºå¤„ç†
â”‚   â””â”€â”€ ğŸ“„ CachedWindowAggFunction.java       ğŸ“Š å¸¦ç¼“å­˜çš„çª—å£èšåˆ
â””â”€â”€ ğŸ“„ SeismicCacheFlinkJob.java        ğŸš€ ä¸»ç¨‹åºå…¥å£
```

### B. å‚è€ƒèµ„æ–™

| ğŸ“š èµ„æ–™ | ğŸ”— é“¾æ¥ |
|--------|--------|
| Apache Flink å®˜æ–¹æ–‡æ¡£ | https://flink.apache.org/docs/ |
| LRU-K ç®—æ³•è®ºæ–‡ | "The LRU-K Page Replacement Algorithm" |
| RocketMQ å®˜æ–¹æ–‡æ¡£ | https://rocketmq.apache.org/docs/ |

---

> ğŸ“ **æ–‡æ¡£ç‰ˆæœ¬å†å²**
> 
> | ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ |
> |------|------|----------|
> | v1.0 | 2026-03-20 | ğŸ‰ åˆå§‹ç‰ˆæœ¬ |
